<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="chess_pieces">

  <!-- Piece dimensions (designed for graspability) -->
  <xacro:property name="piece_base_radius" value="0.015"/>  <!-- 15mm base radius -->
  <xacro:property name="piece_top_radius" value="0.012"/>   <!-- 12mm top radius -->
  <xacro:property name="piece_mass" value="0.050"/>         <!-- 50g per piece -->
  
  <!-- Heights for different pieces -->
  <xacro:property name="pawn_height" value="0.030"/>     <!-- 30mm -->
  <xacro:property name="rook_height" value="0.035"/>     <!-- 35mm -->
  <xacro:property name="knight_height" value="0.040"/>   <!-- 40mm -->
  <xacro:property name="bishop_height" value="0.042"/>   <!-- 42mm -->
  <xacro:property name="queen_height" value="0.048"/>    <!-- 48mm -->
  <xacro:property name="king_height" value="0.050"/>     <!-- 50mm -->

  <!-- Materials -->
  <material name="white_piece">
    <color rgba="0.95 0.95 0.9 1.0"/>
  </material>

  <material name="black_piece">
    <color rgba="0.15 0.15 0.15 1.0"/>
  </material>

  <!-- Piece macro -->
  <xacro:macro name="chess_piece" params="name color piece_type height x_pos y_pos">
    <link name="${name}">
      <inertial>
        <origin xyz="0 0 ${height/2}" rpy="0 0 0"/>
        <mass value="${piece_mass}"/>
        <inertia ixx="0.000001" ixy="0" ixz="0" iyy="0.000001" iyz="0" izz="0.000001"/>
      </inertial>
      
      <!-- Base cylinder -->
      <visual name="base">
        <origin xyz="0 0 ${height/4}" rpy="0 0 0"/>
        <geometry>
          <cylinder radius="${piece_base_radius}" length="${height/2}"/>
        </geometry>
        <material name="${color}_piece"/>
      </visual>
      
      <!-- Top section (tapered) -->
      <visual name="top">
        <origin xyz="0 0 ${3*height/4}" rpy="0 0 0"/>
        <geometry>
          <cylinder radius="${piece_top_radius}" length="${height/2}"/>
        </geometry>
        <material name="${color}_piece"/>
      </visual>
      
      <!-- Piece type indicator (simple geometric shape on top) -->
      <xacro:if value="${piece_type == 'king'}">
        <visual name="crown">
          <origin xyz="0 0 ${height + 0.003}" rpy="0 0 0"/>
          <geometry>
            <box size="0.008 0.020 0.006"/>
          </geometry>
          <material name="${color}_piece"/>
        </visual>
      </xacro:if>
      
      <xacro:if value="${piece_type == 'queen'}">
        <visual name="crown">
          <origin xyz="0 0 ${height + 0.003}" rpy="0 0 0"/>
          <geometry>
            <cylinder radius="0.008" length="0.006"/>
          </geometry>
          <material name="${color}_piece"/>
        </visual>
      </xacro:if>
      
      <xacro:if value="${piece_type == 'bishop'}">
        <visual name="mitre">
          <origin xyz="0 0 ${height + 0.003}" rpy="0 0 0"/>
          <geometry>
            <sphere radius="0.006"/>
          </geometry>
          <material name="${color}_piece"/>
        </visual>
      </xacro:if>
      
      <xacro:if value="${piece_type == 'knight'}">
        <visual name="head">
          <origin xyz="0.005 0 ${height + 0.002}" rpy="0 0 0"/>
          <geometry>
            <box size="0.010 0.008 0.004"/>
          </geometry>
          <material name="${color}_piece"/>
        </visual>
      </xacro:if>
      
      <xacro:if value="${piece_type == 'rook'}">
        <visual name="battlements">
          <origin xyz="0 0 ${height + 0.002}" rpy="0 0 0"/>
          <geometry>
            <box size="0.020 0.020 0.004"/>
          </geometry>
          <material name="${color}_piece"/>
        </visual>
      </xacro:if>
      
      <!-- Collision geometry (optimized for grasping) -->
      <collision>
        <origin xyz="0 0 ${height/2}" rpy="0 0 0"/>
        <geometry>
          <cylinder radius="${piece_base_radius}" length="${height}"/>
        </geometry>
      </collision>
    </link>
    
    <!-- Fixed to world at specified position -->
    <joint name="world_to_${name}" type="fixed">
      <parent link="world"/>
      <child link="${name}"/>
      <origin xyz="${x_pos} ${y_pos} 0" rpy="0 0 0"/>
    </joint>
  </xacro:macro>

  <!-- Initial chess setup positions (standard starting position) -->
  <!-- Board coordinates: files a-h (0-7), ranks 1-8 (7-0 in array) -->
  <xacro:property name="square_size" value="0.057"/>
  
  <!-- Helper macro to calculate board positions -->
  <xacro:macro name="board_position" params="file rank">
    <xacro:property name="x" value="${(file - 3.5) * square_size}"/>
    <xacro:property name="y" value="${(3.5 - rank) * square_size}"/>
  </xacro:macro>

  <!-- White pieces (rank 1 and 2) -->
  
  <!-- White back rank (rank 1) -->
  <xacro:board_position file="0" rank="7"/>
  <xacro:chess_piece name="white_rook_a1" color="white" piece_type="rook" height="${rook_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="1" rank="7"/>
  <xacro:chess_piece name="white_knight_b1" color="white" piece_type="knight" height="${knight_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="2" rank="7"/>
  <xacro:chess_piece name="white_bishop_c1" color="white" piece_type="bishop" height="${bishop_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="3" rank="7"/>
  <xacro:chess_piece name="white_queen_d1" color="white" piece_type="queen" height="${queen_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="4" rank="7"/>
  <xacro:chess_piece name="white_king_e1" color="white" piece_type="king" height="${king_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="5" rank="7"/>
  <xacro:chess_piece name="white_bishop_f1" color="white" piece_type="bishop" height="${bishop_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="6" rank="7"/>
  <xacro:chess_piece name="white_knight_g1" color="white" piece_type="knight" height="${knight_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="7" rank="7"/>
  <xacro:chess_piece name="white_rook_h1" color="white" piece_type="rook" height="${rook_height}" 
                     x_pos="${x}" y_pos="${y}"/>

  <!-- White pawns (rank 2) -->
  <xacro:board_position file="0" rank="6"/>
  <xacro:chess_piece name="white_pawn_a2" color="white" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="1" rank="6"/>
  <xacro:chess_piece name="white_pawn_b2" color="white" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="2" rank="6"/>
  <xacro:chess_piece name="white_pawn_c2" color="white" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="3" rank="6"/>
  <xacro:chess_piece name="white_pawn_d2" color="white" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="4" rank="6"/>
  <xacro:chess_piece name="white_pawn_e2" color="white" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="5" rank="6"/>
  <xacro:chess_piece name="white_pawn_f2" color="white" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="6" rank="6"/>
  <xacro:chess_piece name="white_pawn_g2" color="white" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="7" rank="6"/>
  <xacro:chess_piece name="white_pawn_h2" color="white" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>

  <!-- Black pieces (rank 7 and 8) -->
  
  <!-- Black pawns (rank 7) -->
  <xacro:board_position file="0" rank="1"/>
  <xacro:chess_piece name="black_pawn_a7" color="black" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="1" rank="1"/>
  <xacro:chess_piece name="black_pawn_b7" color="black" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="2" rank="1"/>
  <xacro:chess_piece name="black_pawn_c7" color="black" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="3" rank="1"/>
  <xacro:chess_piece name="black_pawn_d7" color="black" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="4" rank="1"/>
  <xacro:chess_piece name="black_pawn_e7" color="black" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="5" rank="1"/>
  <xacro:chess_piece name="black_pawn_f7" color="black" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="6" rank="1"/>
  <xacro:chess_piece name="black_pawn_g7" color="black" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="7" rank="1"/>
  <xacro:chess_piece name="black_pawn_h7" color="black" piece_type="pawn" height="${pawn_height}" 
                     x_pos="${x}" y_pos="${y}"/>

  <!-- Black back rank (rank 8) -->
  <xacro:board_position file="0" rank="0"/>
  <xacro:chess_piece name="black_rook_a8" color="black" piece_type="rook" height="${rook_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="1" rank="0"/>
  <xacro:chess_piece name="black_knight_b8" color="black" piece_type="knight" height="${knight_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="2" rank="0"/>
  <xacro:chess_piece name="black_bishop_c8" color="black" piece_type="bishop" height="${bishop_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="3" rank="0"/>
  <xacro:chess_piece name="black_queen_d8" color="black" piece_type="queen" height="${queen_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="4" rank="0"/>
  <xacro:chess_piece name="black_king_e8" color="black" piece_type="king" height="${king_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="5" rank="0"/>
  <xacro:chess_piece name="black_bishop_f8" color="black" piece_type="bishop" height="${bishop_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="6" rank="0"/>
  <xacro:chess_piece name="black_knight_g8" color="black" piece_type="knight" height="${knight_height}" 
                     x_pos="${x}" y_pos="${y}"/>
  
  <xacro:board_position file="7" rank="0"/>
  <xacro:chess_piece name="black_rook_h8" color="black" piece_type="rook" height="${rook_height}" 
                     x_pos="${x}" y_pos="${y}"/>

  <!-- Gazebo properties for all pieces -->
  <xacro:macro name="gazebo_piece_properties" params="name">
    <gazebo reference="${name}">
      <material>Gazebo/White</material>
      <mu1>0.8</mu1>
      <mu2>0.8</mu2>
      <kp>100000.0</kp>
      <kd>1000.0</kd>
      <self_collide>true</self_collide>
    </gazebo>
  </xacro:macro>

  <!-- Apply Gazebo properties to all pieces -->
  <!-- White pieces -->
  <xacro:gazebo_piece_properties name="white_king_e1"/>
  <xacro:gazebo_piece_properties name="white_queen_d1"/>
  <xacro:gazebo_piece_properties name="white_rook_a1"/>
  <xacro:gazebo_piece_properties name="white_rook_h1"/>
  <xacro:gazebo_piece_properties name="white_bishop_c1"/>
  <xacro:gazebo_piece_properties name="white_bishop_f1"/>
  <xacro:gazebo_piece_properties name="white_knight_b1"/>
  <xacro:gazebo_piece_properties name="white_knight_g1"/>
  <xacro:gazebo_piece_properties name="white_pawn_a2"/>
  <xacro:gazebo_piece_properties name="white_pawn_b2"/>
  <xacro:gazebo_piece_properties name="white_pawn_c2"/>
  <xacro:gazebo_piece_properties name="white_pawn_d2"/>
  <xacro:gazebo_piece_properties name="white_pawn_e2"/>
  <xacro:gazebo_piece_properties name="white_pawn_f2"/>
  <xacro:gazebo_piece_properties name="white_pawn_g2"/>
  <xacro:gazebo_piece_properties name="white_pawn_h2"/>

  <!-- Black pieces -->
  <xacro:gazebo_piece_properties name="black_king_e8"/>
  <xacro:gazebo_piece_properties name="black_queen_d8"/>
  <xacro:gazebo_piece_properties name="black_rook_a8"/>
  <xacro:gazebo_piece_properties name="black_rook_h8"/>
  <xacro:gazebo_piece_properties name="black_bishop_c8"/>
  <xacro:gazebo_piece_properties name="black_bishop_f8"/>
  <xacro:gazebo_piece_properties name="black_knight_b8"/>
  <xacro:gazebo_piece_properties name="black_knight_g8"/>
  <xacro:gazebo_piece_properties name="black_pawn_a7"/>
  <xacro:gazebo_piece_properties name="black_pawn_b7"/>
  <xacro:gazebo_piece_properties name="black_pawn_c7"/>
  <xacro:gazebo_piece_properties name="black_pawn_d7"/>
  <xacro:gazebo_piece_properties name="black_pawn_e7"/>
  <xacro:gazebo_piece_properties name="black_pawn_f7"/>
  <xacro:gazebo_piece_properties name="black_pawn_g7"/>
  <xacro:gazebo_piece_properties name="black_pawn_h7"/>

</robot>
